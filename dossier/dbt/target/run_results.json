{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.3", "generated_at": "2024-07-02T14:41:49.951824Z", "invocation_id": "7cc640fe-bd5e-44d6-a19f-9013e4784d54", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-07-02T14:41:43.346617Z", "completed_at": "2024-07-02T14:41:43.378899Z"}, {"name": "execute", "started_at": "2024-07-02T14:41:43.379558Z", "completed_at": "2024-07-02T14:41:43.869842Z"}], "thread_id": "Thread-1", "execution_time": 0.5254383087158203, "adapter_response": {"_message": "SELECT 4380", "code": "SELECT", "rows_affected": 4380}, "message": "SELECT 4380", "failures": null, "unique_id": "model.airflow.dim_customer", "compiled": true, "compiled_code": "-- dim_customer.sql\n\n-- Create the dimension table\nWITH customer_cte AS (\n\tSELECT DISTINCT\n\t    md5(cast(coalesce(cast(customerid as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as customer_id,\n\t    Country AS country\n\tFROM products\n\tWHERE CustomerID IS NOT NULL\n)\nSELECT\n    t.*,\n\tcm.iso\nFROM customer_cte t\nLEFT JOIN country cm ON t.country = cm.nicename", "relation_name": "\"airflow\".\"public\".\"dim_customer\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-07-02T14:41:43.878276Z", "completed_at": "2024-07-02T14:41:43.883725Z"}, {"name": "execute", "started_at": "2024-07-02T14:41:43.884409Z", "completed_at": "2024-07-02T14:41:44.328230Z"}], "thread_id": "Thread-1", "execution_time": 0.45234060287475586, "adapter_response": {"_message": "SELECT 23260", "code": "SELECT", "rows_affected": 23260}, "message": "SELECT 23260", "failures": null, "unique_id": "model.airflow.dim_datetime", "compiled": true, "compiled_code": "-- dim_datetime.sql\n\n-- Create a CTE to extract date and time components\nWITH datetime_cte AS (  \n  SELECT DISTINCT\n    invoicedate AS datetime_id,\n    CASE\n      WHEN LENGTH(CAST(invoicedate AS VARCHAR)) = 16 THEN\n        -- Date format: \"DD/MM/YYYY HH:MI\"\n        TO_TIMESTAMP(CAST(invoicedate as TEXT ), 'DD/MM/YYYY HH24:MI')\n      WHEN LENGTH(CAST(invoicedate AS VARCHAR)) <= 14 THEN\n        -- Date format: \"MM/DD/YY HH:MI\"\n\n        TO_TIMESTAMP(CAST(invoicedate as TEXT ), 'MM/DD/YY HH24:MI')\n      ELSE\n        NULL\n    END AS date_part\n  FROM products\n  WHERE invoicedate IS NOT NULL\n)\nSELECT\n  datetime_id,\n  date_part AS datetime,\n  EXTRACT(YEAR FROM date_part) AS year,\n  EXTRACT(MONTH FROM date_part) AS month,\n  EXTRACT(DAY FROM date_part) AS day,\n  EXTRACT(HOUR FROM date_part) AS hour,\n  EXTRACT(MINUTE FROM date_part) AS minute,\n  EXTRACT(ISODOW FROM date_part) AS weekday\nFROM datetime_cte", "relation_name": "\"airflow\".\"public\".\"dim_datetime\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-07-02T14:41:44.335696Z", "completed_at": "2024-07-02T14:41:44.344285Z"}, {"name": "execute", "started_at": "2024-07-02T14:41:44.345264Z", "completed_at": "2024-07-02T14:41:46.253117Z"}], "thread_id": "Thread-1", "execution_time": 1.9197232723236084, "adapter_response": {"_message": "SELECT 16282", "code": "SELECT", "rows_affected": 16282}, "message": "SELECT 16282", "failures": null, "unique_id": "model.airflow.dim_product", "compiled": true, "compiled_code": "-- dim_product.sql\n-- StockCode isn't unique, a product with the same id can have different and prices\n-- Create the dimension table\nSELECT DISTINCT\n    md5(cast(coalesce(cast(stockcode as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(description as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(unitprice as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as product_id,\n\t\tstockcode AS stock_code,\n    description AS description,\n    unitprice AS price\nFROM products\nWHERE stockcode IS NOT NULL\nAND unitprice > 0", "relation_name": "\"airflow\".\"public\".\"dim_product\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-07-02T14:41:46.260483Z", "completed_at": "2024-07-02T14:41:46.272592Z"}, {"name": "execute", "started_at": "2024-07-02T14:41:46.273721Z", "completed_at": "2024-07-02T14:41:49.929122Z"}], "thread_id": "Thread-1", "execution_time": 3.670961380004883, "adapter_response": {"_message": "SELECT 397884", "code": "SELECT", "rows_affected": 397884}, "message": "SELECT 397884", "failures": null, "unique_id": "model.airflow.fct_invoices", "compiled": true, "compiled_code": "-- fct_invoices.sql\n\n-- Create the fact table by joining the relevant keys from dimension table\nWITH fct_invoices_cte AS (\n    SELECT\n        invoiceno AS invoice_id,\n        invoicedate AS datetime_id,\n        md5(cast(coalesce(cast(stockcode as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(description as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(unitprice as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as product_id,\n        md5(cast(coalesce(cast(customerid as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(country as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as customer_id,\n        quantity AS quantity,\n        quantity * unitprice AS total\n    FROM products\n    WHERE quantity > 0\n)\nSELECT\n    fi.invoice_id,\n    dt.datetime_id,\n    dp.product_id,\n    dc.customer_id,\n    fi.quantity,\n    fi.total\nFROM fct_invoices_cte fi\nINNER JOIN \"airflow\".\"public\".\"dim_datetime\" dt ON fi.datetime_id = dt.datetime_id\nINNER JOIN \"airflow\".\"public\".\"dim_product\" dp ON fi.product_id = dp.product_id\nINNER JOIN \"airflow\".\"public\".\"dim_customer\" dc ON fi.customer_id = dc.customer_id", "relation_name": "\"airflow\".\"public\".\"fct_invoices\""}], "elapsed_time": 6.7390947341918945, "args": {"warn_error_options": {"include": [], "exclude": []}, "write_json": true, "which": "run", "profiles_dir": ".", "partial_parse_file_diff": true, "log_file_max_bytes": 10485760, "send_anonymous_usage_stats": true, "empty": false, "macro_debugging": false, "use_colors_file": true, "require_explicit_package_overrides_for_builtin_materializations": true, "static_parser": true, "vars": {}, "invocation_command": "dbt run --profiles-dir .", "select": [], "log_level": "info", "defer": false, "favor_state": false, "indirect_selection": "eager", "log_level_file": "debug", "quiet": false, "source_freshness_run_project_hooks": false, "log_format": "default", "log_format_file": "debug", "strict_mode": false, "exclude": [], "introspect": true, "print": true, "use_colors": true, "partial_parse": true, "show_resource_report": false, "populate_cache": true, "cache_selected_only": false, "project_dir": "/opt/airflow/dossier/dbt", "log_path": "/opt/airflow/dossier/dbt/logs", "printer_width": 80, "enable_legacy_logger": false, "require_resource_names_without_spaces": false, "version_check": true}}